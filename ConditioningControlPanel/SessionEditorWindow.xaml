<Window x:Class="ConditioningControlPanel.SessionEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:ConditioningControlPanel"
        Title="Session Editor"
        Height="765" Width="765"
        MinHeight="680" MinWidth="680"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip"
        MouseLeftButtonDown="Window_MouseLeftButtonDown"
        PreviewMouseDown="Window_PreviewMouseDown">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0"
                      ResizeBorderThickness="8"
                      GlassFrameThickness="0"
                      CornerRadius="12"/>
    </WindowChrome.WindowChrome>

    <Window.Resources>
    </Window.Resources>

    <Grid>
        <Border Background="#1A1A2E" CornerRadius="12" BorderBrush="#FF69B4" BorderThickness="2">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>  <!-- Title bar -->
                    <RowDefinition Height="*"/>     <!-- Scrollable content -->
                </Grid.RowDefinitions>

                <!-- Title Bar -->
                <Grid Grid.Row="0" Background="#252542" Margin="2,2,2,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Session Editor" Foreground="#E0E0E0" FontSize="12"
                               VerticalAlignment="Center" Margin="12,8"/>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,4,8,4">
                        <Button x:Name="BtnHelp" Content="?" Click="BtnHelp_Click" Width="24" Height="24"
                                Background="#FF69B4" Foreground="White" FontSize="12" FontWeight="Bold"
                                BorderThickness="0" Cursor="Hand" ToolTip="How to use the Session Editor">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" CornerRadius="12" Width="24" Height="24">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                        <Button Content="âˆ’" Click="BtnMinimize_Click" Width="24" Height="24"
                                Background="Transparent" Foreground="#888" FontSize="14"
                                BorderThickness="0" Cursor="Hand" Margin="4,0,0,0"/>
                        <Button Content="âœ•" Click="BtnClose_Click" Width="24" Height="24"
                                Background="Transparent" Foreground="#888" FontSize="12"
                                BorderThickness="0" Cursor="Hand"/>
                    </StackPanel>
                </Grid>

                <!-- Scrollable Content Area -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>  <!-- Session name + stats -->
                            <RowDefinition Height="Auto"/>  <!-- Duration slider -->
                            <RowDefinition Height="Auto"/>  <!-- Timeline -->
                            <RowDefinition Height="Auto"/>  <!-- Feature icons -->
                            <RowDefinition Height="Auto"/>  <!-- Description + buttons -->
                        </Grid.RowDefinitions>

                        <!-- Session Name + Stats -->
                        <StackPanel Grid.Row="0" Margin="20,12,20,8">
                            <!-- Session Name (editable) -->
                            <TextBox x:Name="TxtSessionName" Text="My New Session"
                                     FontSize="22" FontWeight="Bold" Foreground="#FF69B4"
                                     Background="Transparent" BorderThickness="0"
                                     HorizontalAlignment="Center" TextAlignment="Center"
                                     CaretBrush="#FF69B4" SelectionBrush="#FF69B4"
                                     ToolTip="Click to edit session name"/>

                            <!-- Auto-calculated stats -->
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,6,0,0">
                                <TextBlock x:Name="TxtDifficulty" Text="â­ Easy"
                                           Foreground="#90EE90" FontSize="11" FontWeight="SemiBold" Margin="0,0,15,0"/>
                                <TextBlock x:Name="TxtXP" Text="+300 XP"
                                           Foreground="#FFD700" FontSize="11" FontWeight="SemiBold" Margin="0,0,15,0"/>
                                <TextBlock x:Name="TxtDuration" Text="30 min"
                                           Foreground="#E0E0E0" FontSize="11" Margin="0,0,0,0"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Duration Slider -->
                        <Grid Grid.Row="1" Margin="20,6,20,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Duration" Foreground="#B0B0B0" FontSize="11"
                                       VerticalAlignment="Center" Margin="0,0,10,0"/>

                            <Slider x:Name="SliderDuration" Grid.Column="1"
                                    Minimum="5" Maximum="181" Value="30"
                                    TickFrequency="5" IsSnapToTickEnabled="True"
                                    ValueChanged="SliderDuration_ValueChanged"/>

                            <TextBlock x:Name="TxtDurationValue" Grid.Column="2" Text="30 min"
                                       Foreground="#E0E0E0" FontSize="11" FontWeight="SemiBold"
                                       VerticalAlignment="Center" Margin="10,0,0,0" Width="45"/>
                        </Grid>

                        <!-- Timeline -->
                        <Border Grid.Row="2" Background="#1E1E3A" CornerRadius="6" Margin="20,6,20,6" Padding="10" MinHeight="100" MaxHeight="180">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>  <!-- Minute markers -->
                                    <RowDefinition Height="*"/>     <!-- Timeline track (scrollable) -->
                                </Grid.RowDefinitions>

                                <!-- Minute Markers -->
                                <Canvas x:Name="CanvasMarkers" Grid.Row="0" Height="16" Margin="0,0,0,4"/>

                                <!-- Timeline Track (drop zone) -->
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Margin="0,0,15,0">
                                    <Border Background="#252542" CornerRadius="4"
                                        AllowDrop="True"
                                        DragEnter="Timeline_DragEnter"
                                        DragOver="Timeline_DragOver"
                                        DragLeave="Timeline_DragLeave"
                                        Drop="Timeline_Drop">
                                        <Canvas x:Name="CanvasTimeline" ClipToBounds="True" MinHeight="40" Background="Transparent">
                                            <!-- Timeline events will be added here dynamically -->
                                            <TextBlock Text="Drag features here to add them to the timeline"
                                                   Foreground="#555" FontSize="10" FontStyle="Italic"
                                                   Canvas.Left="8" Canvas.Top="12"
                                                   x:Name="TxtTimelineHint"/>
                                        </Canvas>
                                    </Border>
                                </ScrollViewer>
                            </Grid>
                        </Border>

                        <!-- Feature Icons Grid - Horizontal Layout -->
                        <Border Grid.Row="3" Margin="20,6,20,6">
                            <Grid x:Name="FeatureIconsPanel">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- AUDIO Category -->
                                <StackPanel Grid.Column="0" Margin="3,0">
                                    <TextBlock Text="AUDIO" Foreground="#FF69B4" FontSize="9" FontWeight="SemiBold"
                                               HorizontalAlignment="Center" Margin="0,3,0,5"/>
                                    <StackPanel x:Name="AudioFeatures" HorizontalAlignment="Center"/>
                                </StackPanel>

                                <!-- VIDEO Category -->
                                <StackPanel Grid.Column="1" Margin="3,0">
                                    <TextBlock Text="VIDEO" Foreground="#FF69B4" FontSize="9" FontWeight="SemiBold"
                                               HorizontalAlignment="Center" Margin="0,3,0,5"/>
                                    <StackPanel x:Name="VideoFeatures" HorizontalAlignment="Center"/>
                                </StackPanel>

                                <!-- OVERLAYS Category -->
                                <StackPanel Grid.Column="2" Margin="3,0">
                                    <TextBlock Text="OVERLAYS" Foreground="#FF69B4" FontSize="9" FontWeight="SemiBold"
                                               HorizontalAlignment="Center" Margin="0,3,0,5"/>
                                    <StackPanel x:Name="OverlayFeatures" HorizontalAlignment="Center"/>
                                </StackPanel>

                                <!-- INTERACTIVE Category -->
                                <StackPanel Grid.Column="3" Margin="3,0">
                                    <TextBlock Text="INTERACTIVE" Foreground="#FF69B4" FontSize="9" FontWeight="SemiBold"
                                               HorizontalAlignment="Center" Margin="0,3,0,5"/>
                                    <StackPanel x:Name="InteractiveFeatures" HorizontalAlignment="Center"/>
                                </StackPanel>

                                <!-- EXTRAS Category -->
                                <StackPanel Grid.Column="4" Margin="3,0">
                                    <TextBlock Text="EXTRAS" Foreground="#FF69B4" FontSize="9" FontWeight="SemiBold"
                                               HorizontalAlignment="Center" Margin="0,3,0,5"/>
                                    <StackPanel x:Name="ExtrasFeatures" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Bottom Section: Description + Buttons -->
                        <Grid Grid.Row="4" Margin="20,6,20,15">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Buttons Row -->
                            <Grid Grid.Row="0" Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Button Content="Import" Style="{StaticResource SecondaryButton}"
                                        Click="BtnImport_Click" Margin="0,0,8,0" FontSize="11" Padding="12,6"/>
                                <Button Grid.Column="1" Content="Export" Style="{StaticResource SecondaryButton}"
                                        Click="BtnExport_Click" FontSize="11" Padding="12,6"/>

                                <Button Grid.Column="3" Content="Cancel" Style="{StaticResource SecondaryButton}"
                                        Click="BtnCancel_Click" Margin="0,0,8,0" FontSize="11" Padding="12,6"/>
                                <Button Grid.Column="4" Content="Save Session" Style="{StaticResource PinkButton}"
                                        Click="BtnSave_Click" FontSize="11" Padding="12,6"/>
                            </Grid>

                            <!-- Vibe Description -->
                            <Grid Grid.Row="1">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Vibe Description" Foreground="#888" FontSize="10" Margin="0,0,0,4"/>
                                <TextBox x:Name="TxtDescription" Grid.Row="1"
                                         Height="55" TextWrapping="Wrap" AcceptsReturn="True"
                                         Background="#252542" Foreground="#E0E0E0"
                                         BorderBrush="#353555" BorderThickness="1"
                                         Padding="8" FontSize="11" VerticalScrollBarVisibility="Auto"
                                         ToolTip="Enter a description for your session"/>
                            </Grid>
                        </Grid>
                    </Grid>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Resize Grip -->
        <ResizeGrip HorizontalAlignment="Right" VerticalAlignment="Bottom"
                    Width="16" Height="16" Margin="0,0,4,4" Cursor="SizeNWSE"/>

        <!-- Popup overlay for settings -->
        <Popup x:Name="SettingsPopup" Placement="Mouse" StaysOpen="True"
               AllowsTransparency="True" PopupAnimation="Fade">
            <local:FeatureSettingsPopup x:Name="FeatureSettings"/>
        </Popup>

        <!-- Tutorial Overlay -->
        <Border x:Name="TutorialOverlay" Visibility="Collapsed" Background="#E0000000" CornerRadius="12">
            <Grid>
                <!-- Close on background click -->
                <Border Background="Transparent" MouseLeftButtonDown="TutorialOverlay_Close"/>

                <!-- Tutorial Content -->
                <Border Background="#1E1E3A" CornerRadius="12" BorderBrush="#FF69B4" BorderThickness="2"
                        MaxWidth="600" MaxHeight="550" VerticalAlignment="Center" HorizontalAlignment="Center"
                        Margin="50" MouseLeftButtonDown="TutorialContent_MouseDown">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <Border Grid.Row="0" Background="#252542" CornerRadius="10,10,0,0" Padding="20,15">
                            <Grid>
                                <TextBlock Text="ðŸ“– How to Use the Session Editor"
                                           Foreground="#FF69B4" FontSize="18" FontWeight="Bold"
                                           HorizontalAlignment="Center"/>
                                <Button Content="âœ•" Click="TutorialOverlay_Close"
                                        HorizontalAlignment="Right" VerticalAlignment="Top"
                                        Background="Transparent" Foreground="#888" FontSize="14"
                                        BorderThickness="0" Cursor="Hand" Margin="0,-5,-5,0"/>
                            </Grid>
                        </Border>

                        <!-- Tutorial Steps -->
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="25,20">
                            <StackPanel>
                                <!-- Step 1 -->
                                <Border Background="#252542" CornerRadius="8" Padding="15" Margin="0,0,0,12">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Border Background="#4CAF50" CornerRadius="12" Width="24" Height="24" Margin="0,0,10,0">
                                                <TextBlock Text="1" Foreground="White" FontWeight="Bold"
                                                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <TextBlock Text="Hover to See Description" Foreground="#E0E0E0" FontSize="14" FontWeight="SemiBold"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <TextBlock Text="Hover over any feature icon to see its name and a brief description of what it does."
                                                   Foreground="#B0B0B0" FontSize="13" TextWrapping="Wrap" Margin="34,0,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- Step 2 -->
                                <Border Background="#252542" CornerRadius="8" Padding="15" Margin="0,0,0,12">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Border Background="#2196F3" CornerRadius="12" Width="24" Height="24" Margin="0,0,10,0">
                                                <TextBlock Text="2" Foreground="White" FontWeight="Bold"
                                                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <TextBlock Text="Drag to Create Segments" Foreground="#E0E0E0" FontSize="14" FontWeight="SemiBold"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <TextBlock Text="Drag a feature icon onto the timeline to create a colored segment. Each segment shows when the effect starts and ends."
                                                   Foreground="#B0B0B0" FontSize="13" TextWrapping="Wrap" Margin="34,0,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- Step 3 -->
                                <Border Background="#252542" CornerRadius="8" Padding="15" Margin="0,0,0,12">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Border Background="#FF9800" CornerRadius="12" Width="24" Height="24" Margin="0,0,10,0">
                                                <TextBlock Text="3" Foreground="White" FontWeight="Bold"
                                                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <TextBlock Text="Resize &amp; Move Segments" Foreground="#E0E0E0" FontSize="14" FontWeight="SemiBold"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <TextBlock Text="Drag the left or right edge handles to resize the segment. Drag the colored bar itself to move the entire segment."
                                                   Foreground="#B0B0B0" FontSize="13" TextWrapping="Wrap" Margin="34,0,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- Step 4 -->
                                <Border Background="#252542" CornerRadius="8" Padding="15" Margin="0,0,0,12">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Border Background="#9C27B0" CornerRadius="12" Width="24" Height="24" Margin="0,0,10,0">
                                                <TextBlock Text="4" Foreground="White" FontWeight="Bold"
                                                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <TextBlock Text="Right-Click to Edit Settings" Foreground="#E0E0E0" FontSize="14" FontWeight="SemiBold"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <TextBlock Text="Right-click any segment on the timeline to open its settings popup. Adjust parameters like intensity, frequency, and more."
                                                   Foreground="#B0B0B0" FontSize="13" TextWrapping="Wrap" Margin="34,0,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- Tip -->
                                <Border Background="#203A20" CornerRadius="8" Padding="15" BorderBrush="#4CAF50" BorderThickness="1">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Border Background="#4CAF50" CornerRadius="12" Width="24" Height="24" Margin="0,0,10,0">
                                                <TextBlock Text="*" Foreground="White" FontWeight="Bold" FontSize="14"
                                                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <TextBlock Text="Full Session Coverage" Foreground="#4CAF50" FontSize="14" FontWeight="SemiBold"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <TextBlock Text="To make an effect last the entire session, simply drag its right edge all the way to the end of the timeline."
                                                   Foreground="#A5D6A7" FontSize="13" TextWrapping="Wrap" Margin="34,0,0,0"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </ScrollViewer>

                        <!-- Footer -->
                        <Border Grid.Row="2" Background="#252542" CornerRadius="0,0,10,10" Padding="20,15">
                            <Button Content="Got it!" Style="{StaticResource PinkButton}"
                                    HorizontalAlignment="Center" Click="TutorialOverlay_Close"
                                    Padding="40,10"/>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
