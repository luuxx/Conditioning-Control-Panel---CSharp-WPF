<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard | Conditioning Control Panel</title>
    <meta name="description" content="Live seasonal leaderboard for Conditioning Control Panel - compete, climb, and prove your dedication!">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèÜ</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="guide-styles.css">
    <style>
        .leaderboard-container {
            max-width: 960px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* ‚îÄ‚îÄ Season Title ‚îÄ‚îÄ */
        .season-banner {
            text-align: center;
            margin-bottom: 2.5rem;
            position: relative;
        }

        .season-label {
            display: inline-block;
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: #b0b0c0;
            margin-bottom: 0.75rem;
        }

        .season-title {
            font-size: clamp(2.2rem, 6vw, 3.5rem);
            font-weight: 900;
            line-height: 1.1;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 25%, #9b59b6 50%, #ff69b4 75%, #ff1493 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .season-title .glow {
            filter: drop-shadow(0 0 20px rgba(255, 105, 180, 0.4));
        }

        .season-subtitle {
            font-size: 1rem;
            color: #b0b0c0;
            font-weight: 400;
        }

        .season-subtitle strong {
            color: #ff69b4;
        }

        /* ‚îÄ‚îÄ Season Info Box ‚îÄ‚îÄ */
        .season-info {
            background: rgba(30, 30, 58, 0.8);
            border: 1px solid rgba(255, 105, 180, 0.15);
            border-radius: 16px;
            padding: 1.5rem 2rem;
            margin-bottom: 2.5rem;
            position: relative;
            overflow: hidden;
        }

        .season-info::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff69b4, #9b59b6, #ff69b4);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
        }

        .season-info h3 {
            font-size: 1rem;
            color: #ff69b4;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .season-info p {
            color: #b0b0c0;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }

        .season-info p:last-child {
            margin-bottom: 0;
        }

        .season-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .season-feature {
            display: flex;
            align-items: flex-start;
            gap: 0.6rem;
            font-size: 0.85rem;
            color: #b0b0c0;
        }

        .season-feature .icon {
            font-size: 1.1rem;
            flex-shrink: 0;
            margin-top: 0.1rem;
        }

        .season-feature strong {
            color: #fff;
        }

        /* ‚îÄ‚îÄ Stats Bar ‚îÄ‚îÄ */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(37, 37, 66, 0.8);
            padding: 1rem 1.75rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 105, 180, 0.15);
            min-width: 120px;
        }

        .stat-item .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ff69b4;
        }

        .stat-item .label {
            font-size: 0.8rem;
            color: #b0b0c0;
            margin-top: 0.15rem;
        }

        /* ‚îÄ‚îÄ Sort Controls ‚îÄ‚îÄ */
        .sort-controls {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .sort-btn {
            background: rgba(37, 37, 66, 0.8);
            border: 1px solid rgba(255, 105, 180, 0.3);
            color: #b0b0c0;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-size: 0.82rem;
            transition: all 0.3s;
        }

        .sort-btn:hover {
            border-color: #ff69b4;
            color: #ff69b4;
        }

        .sort-btn.active {
            background: linear-gradient(135deg, #ff69b4 0%, #9b59b6 100%);
            color: white;
            border-color: transparent;
        }

        .refresh-btn {
            background: transparent;
            border: 1px solid rgba(255, 105, 180, 0.5);
            color: #ff69b4;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-size: 0.82rem;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background: rgba(255, 105, 180, 0.1);
        }

        /* ‚îÄ‚îÄ Leaderboard Table ‚îÄ‚îÄ */
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(30, 30, 58, 0.8);
            border-radius: 12px;
            overflow: hidden;
        }

        .leaderboard-table th {
            background: rgba(37, 37, 66, 0.9);
            padding: 0.85rem 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.82rem;
            color: #ff69b4;
            border-bottom: 2px solid rgba(255, 105, 180, 0.3);
            white-space: nowrap;
        }

        .leaderboard-table th.right {
            text-align: right;
        }

        .leaderboard-table td {
            padding: 0.65rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            font-size: 0.9rem;
        }

        .leaderboard-table tr:hover {
            background: rgba(255, 105, 180, 0.05);
        }

        .leaderboard-table tr.top-1 { background: rgba(255, 215, 0, 0.06); }
        .leaderboard-table tr.top-2 { background: rgba(192, 192, 192, 0.04); }
        .leaderboard-table tr.top-3 { background: rgba(205, 127, 50, 0.04); }

        .rank-cell {
            font-weight: 700;
            width: 55px;
            text-align: center;
        }

        .rank-1 { color: #ffd700; }
        .rank-2 { color: #c0c0c0; }
        .rank-3 { color: #cd7f32; }

        .rank-medal {
            font-size: 1.2rem;
        }

        .user-cell {
            display: flex;
            align-items: center;
            gap: 0.7rem;
        }

        .user-avatar {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff69b4 0%, #9b59b6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-info {
            min-width: 0;
        }

        .user-name-row {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            flex-wrap: wrap;
        }

        .user-name {
            font-weight: 500;
            white-space: nowrap;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.1rem 0.45rem;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .badge-og {
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
            color: #1a1a2e;
        }

        .badge-patreon-1 {
            background: linear-gradient(135deg, #ff424d 0%, #ff1493 100%);
            color: #fff;
        }

        .badge-patreon-2 {
            background: linear-gradient(135deg, #9b59b6 0%, #6c3483 100%);
            color: #fff;
        }

        .badge-patreon-3 {
            background: linear-gradient(135deg, #ffd700 0%, #ff69b4 100%);
            color: #1a1a2e;
        }

        .online-dot {
            width: 8px;
            height: 8px;
            background: #2ecc71;
            border-radius: 50%;
            display: inline-block;
            flex-shrink: 0;
            box-shadow: 0 0 6px rgba(46, 204, 113, 0.5);
        }

        .discord-dm {
            display: inline-flex;
            align-items: center;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .discord-dm:hover {
            opacity: 1;
        }

        .discord-dm svg {
            width: 16px;
            height: 16px;
        }

        .user-title {
            font-size: 0.72rem;
            color: #9b59b6;
        }

        .stat-cell {
            text-align: right;
            font-weight: 500;
            white-space: nowrap;
        }

        .trophy-stat {
            color: #ffd700;
            font-size: 0.8rem;
        }

        .trophy-stat .trophy-icon {
            font-size: 0.75rem;
            margin-right: 0.2rem;
        }

        /* ‚îÄ‚îÄ Loading / Error ‚îÄ‚îÄ */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #b0b0c0;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 105, 180, 0.2);
            border-top-color: #ff69b4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            text-align: center;
            padding: 2rem;
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .last-updated {
            text-align: center;
            font-size: 0.78rem;
            color: #707090;
            margin-top: 1rem;
        }

        /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
        @media (max-width: 768px) {
            .leaderboard-container {
                padding: 1rem;
            }

            .season-title {
                font-size: 2rem;
            }

            .season-info {
                padding: 1.25rem;
            }

            .season-features {
                grid-template-columns: 1fr;
            }

            .leaderboard-table {
                font-size: 0.82rem;
            }

            .leaderboard-table th,
            .leaderboard-table td {
                padding: 0.5rem 0.6rem;
            }

            .user-avatar {
                width: 28px;
                height: 28px;
                font-size: 0.75rem;
            }

            .stats-bar {
                gap: 0.75rem;
            }

            .stat-item {
                padding: 0.75rem 1rem;
                min-width: 100px;
            }

            .hide-mobile {
                display: none !important;
            }
        }

        @media (max-width: 480px) {
            .badge {
                font-size: 0.6rem;
                padding: 0.05rem 0.35rem;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <nav>
        <a href="index.html" class="logo">CCP</a>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="guide.html">Guide</a></li>
            <li><a href="leaderboard.html" class="active">Leaderboard</a></li>
            <li><a href="https://github.com/CodeBambi/Conditioning-Control-Panel---CSharp-WPF" target="_blank">GitHub</a></li>
        </ul>
        <div class="menu-toggle" onclick="toggleMenu()">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <div class="mobile-menu" id="mobileMenu">
        <a href="index.html" onclick="toggleMenu()">Home</a>
        <a href="guide.html" onclick="toggleMenu()">Guide</a>
        <a href="leaderboard.html" onclick="toggleMenu()">Leaderboard</a>
        <a href="https://github.com/CodeBambi/Conditioning-Control-Panel---CSharp-WPF" target="_blank" onclick="toggleMenu()">GitHub</a>
    </div>

    <main class="guide-main">
        <div class="leaderboard-container">
            <!-- Season Banner -->
            <div class="season-banner">
                <div class="season-label" id="seasonLabel">SEASON 0 &middot; 2026</div>
                <h1 class="season-title" id="seasonTitle">Leaderboard</h1>
                <p class="season-subtitle">Compete. Climb. Prove your <strong>dedication</strong>.</p>
            </div>

            <!-- Season Info -->
            <div class="season-info">
                <h3>&#x1f4c5; How Seasons Work</h3>
                <p>
                    CCP runs on a <strong>monthly season</strong> system. At the start of each new season, everyone's
                    level and XP reset back to 1 &mdash; giving every user a fresh chance to compete for the top spots.
                    Your all-time stats are preserved forever, and <strong>Season 0 OGs</strong> get a permanent badge.
                </p>
                <div class="season-features">
                    <div class="season-feature">
                        <span class="icon">&#x1f504;</span>
                        <div><strong>Monthly Resets</strong><br>Level &amp; XP reset each season. Fresh competition every month.</div>
                    </div>
                    <div class="season-feature">
                        <span class="icon">&#x1f3c6;</span>
                        <div><strong>Leaderboard Snapshots</strong><br>End-of-season rankings are archived permanently.</div>
                    </div>
                    <div class="season-feature">
                        <span class="icon">&#x2b50;</span>
                        <div><strong>Skill Tree</strong><br>Unlock powerful skills &amp; bonuses as you level up each season.</div>
                    </div>
                    <div class="season-feature">
                        <span class="icon">&#x1f4dd;</span>
                        <div><strong>Quests</strong><br>Daily, weekly, and seasonal quests for bonus XP.</div>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="value" id="totalUsers">-</div>
                    <div class="label">Total Users</div>
                </div>
                <div class="stat-item">
                    <div class="value" id="onlineUsers">-</div>
                    <div class="label">Online Now</div>
                </div>
                <div class="stat-item">
                    <div class="value" id="seasonId">-</div>
                    <div class="label">Season</div>
                </div>
            </div>

            <!-- Sort Controls -->
            <div class="sort-controls">
                <button class="sort-btn active" data-sort="level">Level</button>
                <button class="sort-btn" data-sort="xp">XP</button>
                <button class="sort-btn" data-sort="total_bubbles_popped">Bubbles</button>
                <button class="sort-btn" data-sort="total_flashes">Flashes</button>
                <button class="sort-btn" data-sort="total_video_minutes">Video Mins</button>
                <button class="sort-btn" data-sort="total_lock_cards_completed">Lock Cards</button>
                <button class="sort-btn" data-sort="is_patreon">Supporters</button>
                <button class="refresh-btn" onclick="fetchLeaderboard()">&#x21bb; Refresh</button>
            </div>

            <!-- Table -->
            <div id="leaderboardContent">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading leaderboard...</p>
                </div>
            </div>

            <div class="last-updated" id="lastUpdated"></div>
        </div>
    </main>

    <footer>
        <div class="footer-links">
            <a href="index.html">Home</a>
            <a href="guide.html">Guide</a>
            <a href="https://github.com/CodeBambi/Conditioning-Control-Panel---CSharp-WPF">GitHub</a>
            <a href="https://github.com/CodeBambi/Conditioning-Control-Panel---CSharp-WPF/releases">Releases</a>
            <a href="https://www.patreon.com/CodeBambi">Patreon</a>
            <a href="privacy-policy.html">Privacy Policy</a>
        </div>
        <p class="footer-tagline">Good girls condition daily</p>
        <p class="footer-copy">&copy; 2025-2026 CodeBambi. Open source under MIT License.</p>
    </footer>

    <script>
        const API_BASE = 'https://codebambi-proxy.vercel.app';
        const LEADERBOARD_URL = `${API_BASE}/v3/leaderboard`;
        const QUESTS_URL = `${API_BASE}/quests/definitions`;
        let currentSort = 'level';

        // Sort button handlers
        document.querySelectorAll('.sort-btn[data-sort]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentSort = btn.dataset.sort;
                fetchLeaderboard();
            });
        });

        // Fetch season title from quest definitions
        async function fetchSeasonTitle() {
            try {
                const res = await fetch(QUESTS_URL);
                if (!res.ok) return;
                const data = await res.json();
                if (data.seasonTitle) {
                    document.getElementById('seasonTitle').textContent = data.seasonTitle;
                }
            } catch (e) {
                // Silently fail ‚Äî default title is fine
            }
        }

        async function fetchLeaderboard() {
            const content = document.getElementById('leaderboardContent');
            content.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading leaderboard...</p>
                </div>
            `;

            try {
                const response = await fetch(`${LEADERBOARD_URL}?sort_by=${currentSort}&limit=10000`);
                if (!response.ok) throw new Error('Failed to fetch');

                const data = await response.json();

                // Update stats
                document.getElementById('totalUsers').textContent = data.total_users?.toLocaleString() || '-';
                document.getElementById('onlineUsers').textContent = data.online_users?.toLocaleString() || '-';

                // Update season info
                if (data.season) {
                    const [year, month] = data.season.split('-');
                    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    const monthName = monthNames[parseInt(month, 10) - 1] || month;
                    document.getElementById('seasonId').textContent = `${monthName} ${year}`;
                    document.getElementById('seasonLabel').innerHTML = `SEASON 0 &middot; ${monthName.toUpperCase()} ${year}`;
                }

                renderLeaderboard(data.entries || []);

                document.getElementById('lastUpdated').textContent =
                    `Last updated: ${new Date().toLocaleTimeString()}`;

            } catch (error) {
                content.innerHTML = `
                    <div class="error-message">
                        <p>Failed to load leaderboard. Please try again later.</p>
                        <button class="refresh-btn" onclick="fetchLeaderboard()" style="margin-top:1rem">Try Again</button>
                    </div>
                `;
            }
        }

        function renderLeaderboard(entries) {
            if (!entries.length) {
                document.getElementById('leaderboardContent').innerHTML = `
                    <div class="error-message">
                        <p>No entries yet. Be the first to join!</p>
                    </div>
                `;
                return;
            }

            // Check if any user has trophy case stats
            const anyTrophy = entries.some(e => e.has_trophy_case);

            const sortLabel = {
                'xp': 'XP',
                'level': 'Level',
                'total_bubbles_popped': 'Bubbles',
                'total_flashes': 'Flashes',
                'total_video_minutes': 'Video Mins',
                'total_lock_cards_completed': 'Lock Cards',
                'is_patreon': 'Supporters'
            }[currentSort] || 'XP';

            let html = `
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th style="text-align:center">Rank</th>
                            <th>User</th>
                            <th class="right">${sortLabel}</th>
                            ${anyTrophy ? '<th class="right hide-mobile">Best Streak</th><th class="right hide-mobile">Best Session</th>' : ''}
                        </tr>
                    </thead>
                    <tbody>
            `;

            entries.forEach(entry => {
                const rankClass = entry.rank <= 3 ? `rank-${entry.rank}` : '';
                const rowClass = entry.rank <= 3 ? `top-${entry.rank}` : '';
                const initial = (entry.display_name || 'A')[0].toUpperCase();
                const onlineDot = entry.is_online ? '<span class="online-dot"></span>' : '';

                // Rank display ‚Äî medals for top 3
                let rankDisplay;
                if (entry.rank === 1) rankDisplay = '<span class="rank-medal">&#x1f947;</span>';
                else if (entry.rank === 2) rankDisplay = '<span class="rank-medal">&#x1f948;</span>';
                else if (entry.rank === 3) rankDisplay = '<span class="rank-medal">&#x1f949;</span>';
                else rankDisplay = `#${entry.rank}`;

                // Stat value
                let statValue;
                if (currentSort === 'is_patreon') {
                    statValue = `Lvl ${entry.level}`;
                } else {
                    statValue = entry[currentSort] || entry.xp || 0;
                    if (currentSort === 'total_video_minutes') {
                        statValue = Math.round(statValue);
                    }
                    statValue = Number(statValue).toLocaleString();
                }

                // Badges
                let badges = '';
                if (entry.is_season0_og) {
                    badges += '<span class="badge badge-og">OG</span>';
                }
                if (entry.is_patreon) {
                    const tier = entry.patreon_tier || 1;
                    const tierNames = { 1: 'Supporter', 2: 'Premium', 3: 'VIP' };
                    badges += `<span class="badge badge-patreon-${tier}">${tierNames[tier] || 'Patron'}</span>`;
                }

                // Discord link
                const discordDm = entry.discord_id
                    ? `<a href="https://discord.com/users/${entry.discord_id}" target="_blank" class="discord-dm" title="View Discord Profile"><svg viewBox="0 0 71 55" fill="#5865F2"><path d="M60.1 4.9A58.5 58.5 0 0045.4.2a.2.2 0 00-.2.1 40.8 40.8 0 00-1.8 3.7 54 54 0 00-16.2 0A37.4 37.4 0 0025.4.3a.2.2 0 00-.2-.1 58.4 58.4 0 00-14.7 4.6.2.2 0 00-.1 0A60 60 0 00.4 43.8a.2.2 0 000 .2 58.7 58.7 0 0017.7 9 .2.2 0 00.3-.1 42 42 0 003.6-5.9.2.2 0 00-.1-.3 38.7 38.7 0 01-5.5-2.6.2.2 0 01.5-.4l1.1.9a.2.2 0 00.2 0 41.8 41.8 0 0035.6 0 .2.2 0 01.3 0l1 .9a.2.2 0 00.6.3 38.5 38.5 0 01-5.6 2.6.2.2 0 00-.1.4 47.2 47.2 0 003.6 5.8.2.2 0 00.3.1 58.5 58.5 0 0017.7-9 .2.2 0 000-.1c1.5-15.3-2.4-28.6-10.4-40.4a.2.2 0 00-.1 0zM23.7 35.9c-3.5 0-6.4-3.2-6.4-7.1s2.8-7.2 6.4-7.2 6.5 3.2 6.4 7.2c0 3.9-2.8 7.1-6.4 7.1zm23.6 0c-3.5 0-6.4-3.2-6.4-7.1s2.8-7.2 6.4-7.2 6.5 3.2 6.4 7.2c0 3.9-2.8 7.1-6.4 7.1z"/></svg></a>`
                    : '';

                // Trophy case columns
                let trophyCols = '';
                if (anyTrophy) {
                    if (entry.has_trophy_case) {
                        const streak = entry.highest_streak || 0;
                        const session = entry.longest_session_minutes || 0;
                        trophyCols += `<td class="stat-cell hide-mobile"><span class="trophy-stat"><span class="trophy-icon">&#x1f525;</span>${streak}d</span></td>`;
                        trophyCols += `<td class="stat-cell hide-mobile"><span class="trophy-stat"><span class="trophy-icon">&#x23f1;</span>${session.toFixed(1)}m</span></td>`;
                    } else {
                        trophyCols += '<td class="stat-cell hide-mobile"><span style="color:#707090">-</span></td>';
                        trophyCols += '<td class="stat-cell hide-mobile"><span style="color:#707090">-</span></td>';
                    }
                }

                html += `
                    <tr class="${rowClass}">
                        <td class="rank-cell ${rankClass}">${rankDisplay}</td>
                        <td>
                            <div class="user-cell">
                                <div class="user-avatar">${initial}</div>
                                <div class="user-info">
                                    <div class="user-name-row">
                                        <span class="user-name">${escapeHtml(entry.display_name || 'Anonymous')}</span>
                                        ${badges}
                                        ${discordDm}
                                        ${onlineDot}
                                    </div>
                                    <div class="user-title">${escapeHtml(entry.title || 'Level ' + entry.level)}</div>
                                </div>
                            </div>
                        </td>
                        <td class="stat-cell">${statValue}</td>
                        ${trophyCols}
                    </tr>
                `;
            });

            html += '</tbody></table>';
            document.getElementById('leaderboardContent').innerHTML = html;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function toggleMenu() {
            const toggle = document.querySelector('.menu-toggle');
            const menu = document.getElementById('mobileMenu');
            toggle.classList.toggle('active');
            menu.classList.toggle('active');
            document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : '';
        }

        // Initial load
        fetchSeasonTitle();
        fetchLeaderboard();

        // Auto-refresh every 2 minutes
        setInterval(fetchLeaderboard, 120000);
    </script>
</body>
</html>
